<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Tegych AI - Professional Conversational Interface">
    <title>Tegych AI | Enterprise</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Fira+Code&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Markdown & Highlight -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <!-- Telegram Web App -->
    <script src="https://telegram.org/js/telegram-web-app.js" defer></script>

    <style>
        :root {
            /* --- VARS DEFAULT (Dark Modern) --- */
            --bg-body: #0f1117;
            --bg-sidebar: #161b22;
            --bg-chat: #0f1117;
            --bg-input: #1f242d;
            --border: #30363d;
            --accent: #238636; /* GitHub Greenish */
            --accent-hover: #2ea043;
            --text-main: #e6edf3;
            --text-muted: #8b949e;
            --msg-user: #1f6feb;
            --msg-bot: #161b22;
            --radius: 12px;
            --shadow: 0 4px 12px rgba(0,0,0,0.2);
            --font-main: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        /* --- THEMES --- */

        /* 1. Light (Corporate) */
        [data-theme="light"] {
            --bg-body: #ffffff;
            --bg-sidebar: #f6f8fa;
            --bg-chat: #ffffff;
            --bg-input: #f6f8fa;
            --border: #d0d7de;
            --accent: #0969da;
            --text-main: #24292f;
            --text-muted: #57606a;
            --msg-user: #0969da;
            --msg-bot: #f6f8fa;
        }

        /* 2. Neumorphism (Soft) */
        [data-theme="neumorphism"] {
            --bg-body: #e0e5ec;
            --bg-sidebar: #e0e5ec;
            --bg-chat: #e0e5ec;
            --bg-input: #e0e5ec;
            --border: transparent;
            --accent: #6d5dfc;
            --text-main: #4a4a4a;
            --text-muted: #888;
            --msg-user: #6d5dfc;
            --msg-bot: #e0e5ec;
            --shadow: 9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5);
        }

        /* 3. Terminal (Hacker) */
        [data-theme="terminal"] {
            --bg-body: #000000;
            --bg-sidebar: #111;
            --bg-chat: #000;
            --bg-input: #111;
            --border: #333;
            --accent: #00ff00;
            --text-main: #00ff00;
            --text-muted: #008f11;
            --msg-user: #003300;
            --msg-bot: #111;
            --font-main: 'Fira Code', monospace;
            --radius: 0px;
        }

        /* 4. OLED Black (Mobile Saver) */
        [data-theme="oled"] {
            --bg-body: #000000;
            --bg-sidebar: #000000;
            --bg-chat: #000000;
            --bg-input: #111111;
            --border: #222;
            --accent: #ffffff;
            --text-main: #ffffff;
            --text-muted: #666;
            --msg-user: #222;
            --msg-bot: #0a0a0a;
        }

        /* 5. Cyberpunk */
        [data-theme="cyberpunk"] {
            --bg-body: #050510;
            --bg-sidebar: #0b0b1a;
            --bg-chat: #050510;
            --bg-input: #151525;
            --border: #ff0055;
            --accent: #00f3ff;
            --text-main: #00f3ff;
            --text-muted: #ff0055;
            --msg-user: #ff0055;
            --msg-bot: #0b0b1a;
        }

        /* 6. Dracula */
        [data-theme="dracula"] {
            --bg-body: #282a36;
            --bg-sidebar: #21222c;
            --bg-chat: #282a36;
            --bg-input: #44475a;
            --border: #6272a4;
            --accent: #ff79c6;
            --text-main: #f8f8f2;
            --text-muted: #bd93f9;
            --msg-user: #bd93f9;
            --msg-bot: #44475a;
        }

        /* 7. Midnight Blue */
        [data-theme="midnight"] {
            --bg-body: #0f172a;
            --bg-sidebar: #1e293b;
            --bg-chat: #0f172a;
            --bg-input: #1e293b;
            --border: #334155;
            --accent: #38bdf8;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --msg-user: #0ea5e9;
            --msg-bot: #1e293b;
        }

        /* --- RESET & LAYOUT --- */
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body {
            background: var(--bg-body); color: var(--text-main); font-family: var(--font-main);
            height: 100vh; display: flex; overflow: hidden; transition: background 0.3s ease;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px; background: var(--bg-sidebar); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 20px;
            transition: transform 0.3s ease; z-index: 100;
        }
        
        .brand {
            display: flex; align-items: center; gap: 12px; margin-bottom: 30px;
            font-size: 20px; font-weight: 700; color: var(--text-main);
        }
        .brand-logo {
            width: 32px; height: 32px; border-radius: 8px; background: var(--accent);
            display: flex; align-items: center; justify-content: center; color: #fff;
        }

        .nav-item {
            display: flex; align-items: center; gap: 10px; padding: 12px; color: var(--text-muted);
            border-radius: var(--radius); cursor: pointer; transition: 0.2s; font-size: 14px;
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: var(--text-main); }
        .nav-item.active { background: rgba(255,255,255,0.05); color: var(--accent); font-weight: 600; }

        .sidebar-footer { margin-top: auto; border-top: 1px solid var(--border); padding-top: 20px; }
        
        .pro-toggle {
            display: flex; align-items: center; justify-content: space-between; padding: 10px;
            background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            border: 1px solid var(--border); border-radius: var(--radius); cursor: pointer;
        }
        .pro-badge { background: var(--accent); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 700; }

        /* --- MAIN AREA --- */
        .main { flex: 1; display: flex; flex-direction: column; position: relative; background: var(--bg-chat); }

        .header {
            height: 60px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; background: var(--bg-chat); z-index: 10;
        }
        .header-title { font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .model-tag { font-size: 11px; padding: 4px 8px; background: var(--bg-input); border-radius: 20px; color: var(--text-muted); border: 1px solid var(--border); }
        
        .mobile-menu-btn { display: none; font-size: 20px; cursor: pointer; color: var(--text-muted); }

        /* --- CHAT LIST --- */
        .chat-list { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        
        .message { display: flex; gap: 15px; max-width: 800px; margin: 0 auto; width: 100%; animation: fadeIn 0.3s ease; }
        .message.user { flex-direction: row-reverse; }
        
        .avatar {
            width: 36px; height: 36px; border-radius: 8px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;
        }
        .avatar.bot { background: var(--accent); color: #fff; }
        .avatar.user { background: var(--msg-user); color: #fff; }

        .msg-content {
            background: var(--msg-bot); padding: 12px 18px; border-radius: 12px; border: 1px solid var(--border);
            font-size: 15px; line-height: 1.6; min-width: 100px;
        }
        .message.user .msg-content { background: var(--msg-user); color: #fff; border: none; }
        
        /* Neumorphism Overrides */
        [data-theme="neumorphism"] .msg-content { box-shadow: var(--shadow); border: none; }
        [data-theme="neumorphism"] .sidebar { box-shadow: 5px 0 15px rgba(0,0,0,0.05); }

        /* Markdown Styles */
        .msg-content p { margin-bottom: 10px; }
        .msg-content p:last-child { margin-bottom: 0; }
        .msg-content pre { position: relative; background: #0d1117; padding: 12px; border-radius: 8px; overflow-x: auto; margin: 10px 0; border: 1px solid #30363d; }
        .msg-content code { font-family: var(--font-code); font-size: 13px; }
        .msg-content pre code { background: transparent; padding: 0; color: #e6edf3; }
        .msg-content p code { background: rgba(175, 184, 193, 0.2); padding: 2px 6px; border-radius: 4px; }
        
        .copy-btn {
            position: absolute; top: 5px; right: 5px; background: rgba(255,255,255,0.1); border: none;
            color: #fff; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;
        }
        .copy-btn:hover { background: rgba(255,255,255,0.2); }

        /* --- INPUT --- */
        .input-area {
            padding: 20px; border-top: 1px solid var(--border); background: var(--bg-chat);
        }
        .input-container {
            max-width: 800px; margin: 0 auto; position: relative;
            background: var(--bg-input); border: 1px solid var(--border); border-radius: var(--radius);
            padding: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; gap: 10px; align-items: flex-end;
        }
        .input-container:focus-within { border-color: var(--accent); }

        #user-input {
            flex: 1; background: transparent; border: none; padding: 12px; color: var(--text-main);
            font-size: 15px; resize: none; max-height: 150px; font-family: inherit;
        }

        .action-btn {
            width: 36px; height: 36px; border-radius: 8px; border: none; background: transparent;
            color: var(--text-muted); cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .action-btn:hover { color: var(--text-main); background: rgba(255,255,255,0.05); }
        
        #send-btn { background: var(--accent); color: white; }
        #send-btn:hover { background: var(--accent-hover); }

        /* --- MODALS & SETTINGS --- */
        .settings-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--bg-sidebar); border: 1px solid var(--border); padding: 25px;
            border-radius: var(--radius); width: 300px; z-index: 1000; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: none;
        }
        .settings-modal.active { display: block; animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 900; display: none; }
        .overlay.active { display: block; }

        .settings-group { margin-bottom: 15px; }
        .settings-group label { display: block; font-size: 13px; color: var(--text-muted); margin-bottom: 8px; font-weight: 600; }
        select {
            width: 100%; padding: 10px; background: var(--bg-input); border: 1px solid var(--border);
            color: var(--text-main); border-radius: 8px; cursor: pointer;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { from { opacity: 0; transform: translate(-50%, -40%); } to { opacity: 1; transform: translate(-50%, -50%); } }

        /* Mobile */
        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -260px; height: 100%; box-shadow: 5px 0 15px rgba(0,0,0,0.3); }
            .sidebar.open { left: 0; transform: none; }
            .mobile-menu-btn { display: block; }
            .message { max-width: 100%; }
            .overlay.mobile-active { display: block; }
        }
    </style>
</head>
<body data-theme="dark">

    <!-- OVERLAY FOR MOBILE/MODAL -->
    <div class="overlay" id="overlay" onclick="closeAll()"></div>

    <!-- SETTINGS MODAL -->
    <div class="settings-modal" id="settings-modal">
        <h3 style="margin-bottom: 20px;">Preferences</h3>
        
        <div class="settings-group">
            <label>Visual Theme</label>
            <select onchange="changeTheme(this.value)">
                <option value="dark">üåë Modern Dark</option>
                <option value="light">‚òÄÔ∏è Corporate Light</option>
                <option value="midnight">üåå Midnight Blue</option>
                <option value="dracula">üßõ Dracula</option>
                <option value="cyberpunk">üëæ Cyberpunk</option>
                <option value="terminal">üíª Terminal</option>
                <option value="neumorphism">‚ö™ Neumorphism</option>
                <option value="oled">‚¨õ OLED Black</option>
            </select>
        </div>

        <button onclick="closeAll()" style="width:100%; padding:10px; background:var(--accent); color:#fff; border:none; border-radius:8px; cursor:pointer;">Save Changes</button>
    </div>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="brand">
            <div class="brand-logo"><i class="fas fa-robot"></i></div>
            <span>Tegych AI</span>
        </div>

        <nav style="display:flex; flex-direction:column; gap:5px;">
            <div class="nav-item active"><i class="fas fa-comment-alt"></i> New Chat</div>
            <div class="nav-item" onclick="exportChat()"><i class="fas fa-download"></i> Export TXT</div>
            <div class="nav-item" onclick="openSettings()"><i class="fas fa-cog"></i> Settings</div>
        </nav>

        <div class="sidebar-footer">
            <div class="pro-toggle" onclick="togglePro()">
                <div style="font-size:13px; font-weight:600;">Pro Model</div>
                <div class="pro-badge" id="pro-badge">OFF</div>
            </div>
        </div>
    </aside>

    <!-- MAIN CHAT -->
    <main class="main">
        <header class="header">
            <div class="header-title">
                <div class="mobile-menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
                <span>Chat Session</span>
                <span class="model-tag" id="model-display">Mistral Small</span>
            </div>
            <div>
                <button class="action-btn" onclick="clearChat()" title="Clear"><i class="fas fa-trash"></i></button>
            </div>
        </header>

        <div class="chat-list" id="chat-container">
            <!-- Messages go here -->
        </div>

        <div class="input-area">
            <div class="input-container">
                <button class="action-btn" onclick="triggerUpload()"><i class="fas fa-paperclip"></i></button>
                <input type="text" id="user-input" placeholder="Message Tegych AI..." autocomplete="off">
                <button class="action-btn" id="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
            <div style="text-align:center; font-size:11px; color:var(--text-muted); margin-top:10px;">
                AI can make mistakes. Check important info.
            </div>
        </div>
    </main>

    <script>
        // --- CONFIGURATION ---
        const API_KEY = "8fVDXLED6cbXbT0ObTYuBhitYkjB5ABV"; // ‚ö†Ô∏è Insert Key
        const API_URL = "https://api.mistral.ai/v1/chat/completions";

        let state = {
            proMode: false,
            // üß† INTELLIGENT SYSTEM PROMPT
            history: [{ 
                role: "system", 
                content: "You are Tegych AI, a professional assistant. " +
                         "Detect the language of the user's message. " +
                         "If they speak Russian, answer in Russian. " +
                         "If English, answer in English. " +
                         "Use Markdown for code and formatting. Be concise and helpful." 
            }]
        };

        const dom = {
            chat: document.getElementById('chat-container'),
            input: document.getElementById('user-input'),
            settings: document.getElementById('settings-modal'),
            overlay: document.getElementById('overlay'),
            sidebar: document.getElementById('sidebar')
        };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            // Initial Welcome
            addMessage("Hello! I am **Tegych AI**. \nI auto-detect language (RU/EN). How can I help you today?", 'bot');
            
            // Set up marked.js
            marked.setOptions({
                highlight: function(code, lang) {
                    return highlight.highlightAuto(code).value;
                }
            });

            // Enter Key
            dom.input.addEventListener('keypress', (e) => {
                if(e.key === 'Enter') sendMessage();
            });
        });

        // --- CORE LOGIC ---

        function addMessage(text, sender) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender}`;
            
            // Avatar
            const avatar = document.createElement('div');
            avatar.className = `avatar ${sender}`;
            avatar.innerHTML = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
            
            // Content
            const content = document.createElement('div');
            content.className = 'msg-content';
            
            if (sender === 'user') {
                content.innerText = text;
            } else {
                // Parse Markdown
                content.innerHTML = marked.parse(text);
                // Add Copy Buttons to Code Blocks
                content.querySelectorAll('pre').forEach(pre => {
                    const btn = document.createElement('button');
                    btn.className = 'copy-btn';
                    btn.innerText = 'Copy';
                    btn.onclick = () => {
                        navigator.clipboard.writeText(pre.innerText);
                        btn.innerText = 'Copied!';
                        setTimeout(() => btn.innerText = 'Copy', 2000);
                    };
                    pre.appendChild(btn);
                });
            }

            msgDiv.appendChild(avatar);
            msgDiv.appendChild(content);
            dom.chat.appendChild(msgDiv);
            dom.chat.scrollTop = dom.chat.scrollHeight;
        }

        async function sendMessage() {
            const text = dom.input.value.trim();
            if(!text) return;

            // UI Updates
            dom.input.value = '';
            addMessage(text, 'user');
            
            // Show Typing Placeholder
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot typing-temp';
            typingDiv.innerHTML = `<div class="avatar bot"><i class="fas fa-robot"></i></div><div class="msg-content">Typing...</div>`;
            dom.chat.appendChild(typingDiv);
            dom.chat.scrollTop = dom.chat.scrollHeight;

            state.history.push({ role: "user", content: text });

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: state.proMode ? "mistral-medium" : "mistral-small-latest",
                        messages: state.history,
                        temperature: 0.7
                    })
                });

                // Remove typing indicator
                document.querySelector('.typing-temp')?.remove();

                if(!response.ok) throw new Error("API Connection Error");

                const data = await response.json();
                const aiText = data.choices[0].message.content;

                addMessage(aiText, 'bot');
                state.history.push({ role: "assistant", content: aiText });

            } catch (e) {
                document.querySelector('.typing-temp')?.remove();
                addMessage(`‚ö†Ô∏è Error: ${e.message}`, 'bot');
            }
        }

        // --- UTILITIES ---

        function changeTheme(theme) {
            document.body.setAttribute('data-theme', theme);
        }

        function togglePro() {
            state.proMode = !state.proMode;
            const badge = document.getElementById('pro-badge');
            const modelTag = document.getElementById('model-display');
            
            if(state.proMode) {
                badge.style.background = "#fff"; 
                badge.style.color = "var(--accent)"; 
                badge.innerText = "ON";
                modelTag.innerText = "Mistral Medium (Pro)";
            } else {
                badge.style.background = "var(--accent)"; 
                badge.style.color = "#fff"; 
                badge.innerText = "OFF";
                modelTag.innerText = "Mistral Small";
            }
        }

        function exportChat() {
            let text = "";
            state.history.forEach(msg => {
                if(msg.role !== 'system') text += `${msg.role.toUpperCase()}: ${msg.content}\n\n`;
            });
            const blob = new Blob([text], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'chat_export.txt';
            a.click();
        }

        function clearChat() {
            dom.chat.innerHTML = '';
            state.history = [state.history[0]];
            addMessage("Chat cleared.", 'bot');
        }

        function triggerUpload() { alert("File upload module active."); }

        // --- UI TOGGLES ---
        function toggleSidebar() {
            dom.sidebar.classList.toggle('open');
            dom.overlay.classList.toggle('mobile-active');
        }

        function openSettings() {
            dom.settings.classList.add('active');
            dom.overlay.classList.add('active');
        }

        function closeAll() {
            dom.settings.classList.remove('active');
            dom.overlay.classList.remove('active');
            dom.sidebar.classList.remove('open');
            dom.overlay.classList.remove('mobile-active');
        }

    </script>
</body>
</html>
